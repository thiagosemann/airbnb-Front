<!-- escala-faxina.component.html -->
<div class="calendar-container">
  <!-- Abas -->
  <nav class="tabs-header">
    <ul>
      <li *ngFor="let tab of tabs"
          [class.active]="activeTab === tab.id"
          (click)="selectTab(tab.id)">
        {{ tab.label }}
      </li>
    </ul>
  </nav>

  <!-- Conteúdos por aba -->
  <div class="tabs-content">

    <!-- Resumo Esta Semana -->
    <section class="tab-section" [class.active]="activeTab === 'resumoEsta'">
      <table class="calendar-table resumo-table">
        <thead>
          <tr>
            <th>Terceirizada</th>
            <th *ngFor="let dia of diasDaSemana">{{ dia }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of objectValues(terceirizadasResumoEsta)">
            <td>{{ t.nome }}</td>
            <td *ngFor="let dia of diasDaSemana">{{ t.dias[dia] || 0 }}</td>
          </tr>
          <tr *ngIf="!objectValues(terceirizadasResumoEsta).length">
            <td colspan="8">Nenhuma faxina nesta semana</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Resumo Próxima Semana -->
    <section class="tab-section" [class.active]="activeTab === 'resumoProxima'">
      <table class="calendar-table resumo-table">
        <thead>
          <tr>
            <th>Terceirizada</th>
            <th *ngFor="let dia of diasDaSemana">{{ dia }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of objectValues(terceirizadasResumoProxima)">
            <td>{{ t.nome }}</td>
            <td *ngFor="let dia of diasDaSemana">{{ t.dias[dia] || 0 }}</td>
          </tr>
          <tr *ngIf="!objectValues(terceirizadasResumoProxima).length">
            <td colspan="8">Nenhuma faxina na próxima semana</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Faxinas para Hoje -->
    <section *ngIf="activeTab === 'hoje'">
      <table class="calendar-table">
        <thead>
          <ng-container *ngIf="user?.role !== 'tercerizado'">
            <tr>
              <th>Apt</th>
              <th>Check-Out</th>
              <th>Finalizado</th>
              <th>Responsável</th>
              <th>Total do Dia</th> <!-- NOVA COLUNA -->

            </tr>
          </ng-container>
          <ng-container *ngIf="user?.role === 'tercerizado'">
            <tr>
              <th>Apt</th>
              <th>Check-Out</th>
              <th>Finalizado</th>
            </tr>
          </ng-container>
        </thead>
        <tbody>
          <tr *ngFor="let faxina of faxinasHoje">
            <td>{{ faxina.apartamento_nome }}</td>
            <td>{{ faxina.check_out }} - {{ formatarCheckInMesmoDia(faxina.check_in_mesmo_dia) }}</td>
            <td>
              <label class="custom-checkbox">
                <input type="checkbox"
                       [checked]="faxina.limpeza_realizada"
                       (change)="updateStatus(faxina, 'limpeza_realizada', $event, 'faxinasHoje')">
                <span class="checkmark"></span>
              </label>
            </td>
            <td *ngIf="user?.role !== 'tercerizado'">
              <select
                class="service-select"
                [(ngModel)]="faxina.faxina_userId"
                (change)="updateRserva(faxina)">
                <option value="">Selecione</option>
                <option *ngFor="let u of users" [value]="u.id">{{ u.first_name }}</option>
              </select>
            </td>
            <td>
              {{ contarFaxinasPorDia(faxina.faxina_userId, formatarData(faxina.end_data), faxinasHoje) }}
            </td>
          </tr>
          
          <tr *ngIf="faxinasHoje.length === 0">
            <td colspan="5">Nenhuma faxina para hoje</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Faxinas Esta Semana -->
    <section *ngIf="activeTab === 'semana'">
      <table class="calendar-table">
        <thead>
          <tr>
            <th>Apt</th>
            <th>Data</th>
            <th>Dia</th>
            <th>Check-Out</th>
            <th>Responsável</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let faxina of faxinasSemana">
            <td>{{ faxina.apartamento_nome }}</td>
            <td>{{ formatarData(faxina.end_data) }}</td>
            <td>{{ getDiaDaSemana(formatarData(faxina.end_data)) }}</td>
            <td>{{ faxina.check_out }} {{ formatarCheckInMesmoDia(faxina.check_in_mesmo_dia) }}</td>
            <td>
              <select
                class="service-select"
                [(ngModel)]="faxina.faxina_userId"
                (change)="updateRserva(faxina)"
                [disabled]="user?.role === 'tercerizado'">
                <option value="">Selecione</option>
                <option *ngFor="let u of users" [value]="u.id">{{ u.first_name }}</option>
              </select>
            </td>
          </tr>
          <tr *ngIf="faxinasSemana.length === 0">
            <td colspan="5">Nenhuma faxina esta semana</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Faxinas Semana que Vem -->
    <section *ngIf="activeTab === 'proxima' && user?.role !== 'tercerizado'">
      <table class="calendar-table">
        <thead>
          <tr>
            <th>Apt</th>
            <th>Data</th>
            <th>Dia</th>
            <th>Check-Out</th>
            <th>Responsável</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let faxina of faxinasSemanaQueVem">
            <td>{{ faxina.apartamento_nome }}</td>
            <td>{{ formatarData(faxina.end_data) }}</td>
            <td>{{ getDiaDaSemana(formatarData(faxina.end_data)) }}</td>
            <td>{{ faxina.check_out }} {{ formatarCheckInMesmoDia(faxina.check_in_mesmo_dia) }}</td>
            <td>
              <select
                class="service-select"
                [(ngModel)]="faxina.faxina_userId"
                (change)="updateRserva(faxina)">
                <option value="">Selecione</option>
                <option *ngFor="let u of users" [value]="u.id">{{ u.first_name }}</option>
              </select>
            </td>
          </tr>
          <tr *ngIf="faxinasSemanaQueVem.length === 0">
            <td colspan="5">Nenhuma faxina semana que vem</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Faxinas Futuras -->
    <section *ngIf="activeTab === 'futuras' && user?.role !== 'tercerizado'">
      <table class="calendar-table">
        <thead>
          <tr>
            <th>Apt</th>
            <th>Check-Out</th>
            <th>Dias Restantes</th>
            <th>Responsável</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let faxina of faxinasFuturas">
            <td>{{ faxina.apartamento_nome }}</td>
            <td>{{ formatarData(faxina.end_data) }}</td>
            <td>{{ calcularDiasRestantes(faxina.end_data) }}</td>
            <td>
              <select
                class="service-select"
                [(ngModel)]="faxina.faxina_userId"
                (change)="updateRserva(faxina)">
                <option value="">Selecione</option>
                <option *ngFor="let u of users" [value]="u.id">{{ u.first_name }}</option>
              </select>
            </td>
          </tr>
          <tr *ngIf="faxinasFuturas.length === 0">
            <td colspan="5">Nenhuma faxina futura</td>
          </tr>
        </tbody>
      </table>
    </section>

  </div>
</div>
