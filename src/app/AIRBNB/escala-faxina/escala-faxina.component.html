<!-- escala-faxina.component.html -->
<div class="calendar-container">
  <!-- Abas -->
  <nav class="tabs-header">
    <ul>
      <ng-container *ngFor="let tab of tabs">
            <li  [class.active]="activeTab === tab.id" (click)="selectTab(tab.id)">
              {{ tab.label }}
            </li>
      </ng-container>
    </ul>
  </nav>

  <!-- Conteúdos por aba -->
  <div class="tabs-content">

   <!-- Faxinas para Hoje -->
    <section *ngIf="activeTab === 'hoje'">
      <div class="enxoval-summary" *ngIf="!carregando && faxinasHoje.length">
        <div class="summary-title">Enxoval necessário hoje</div>
        <div class="summary-grid">
          <div class="summary-chip"><span>SL Casal</span><strong>{{ enxovalTotaisHoje.enxovalSobreLencolCasal }}</strong></div>
          <div class="summary-chip"><span>SL Solteiro</span><strong>{{ enxovalTotaisHoje.enxovalSobreLencolSolteiro }}</strong></div>
          <div class="summary-chip"><span>Fronha</span><strong>{{ enxovalTotaisHoje.enxovalFronha }}</strong></div>
          <div class="summary-chip"><span>Toalhas</span><strong>{{ enxovalTotaisHoje.enxovalToalhas }}</strong></div>
          <div class="summary-chip"><span>Pisos</span><strong>{{ enxovalTotaisHoje.enxovalPisos }}</strong></div>
          <div class="summary-chip"><span>Rostos</span><strong>{{ enxovalTotaisHoje.enxovalRostos }}</strong></div>
          <div class="summary-chip total-chip"><span>Total de peças</span><strong>{{ totalDePecasEnxoval(enxovalTotaisHoje) }}</strong></div>
        </div>
      </div>
      <div class="faxina-cards mobile-only">
        <div *ngIf="faxinasHoje.length === 0" class="no-data">
          Nenhuma faxina para hoje
        </div>
        <div *ngFor="let faxina of faxinasHoje"
            class="faxina-card"
            [class.cancelada]="faxina.description === 'CANCELADA'">

          <div class="card-header">
            <h3>Apt {{ faxina.apartamento_nome }}</h3>
            <ng-container *ngIf="faxina.description === 'CANCELADA'">
                <span class="status-badge" [class.done]="faxina.limpeza_realizada">
                  {{ '❌ CANCELADA' }}
                </span>
            </ng-container>
            <ng-container *ngIf="faxina.description !== 'CANCELADA'">
                <span class="status-badge" [class.done]="faxina.limpeza_realizada">
                  {{ faxina.limpeza_realizada ? '✔ Finalizado' : '⌛️ Pendente' }}
                </span>
            </ng-container>
          </div>

          <div class="card-body">
            <div class="card-row">
              <strong>Check-Out:</strong>
              <span>{{ faxina.check_out }} – {{ formatarCheckInMesmoDia(faxina) }}</span>
            </div>
            <div class="card-row">
              <strong>Senha:</strong>
              <strong>{{ faxina.apartamento_senha }}</strong>
            </div>
          </div>

          <!-- Mantive o checkbox caso queira toggle manual -->
          <div class="card-footer">
            <label class="custom-checkbox">
              <input type="checkbox"
                    [checked]="faxina.limpeza_realizada"
                    (change)="updateStatus(faxina, 'limpeza_realizada', $event, 'faxinasHoje')">
              <span class="checkmark"></span>
            </label>
            <span (click)="abrirModalEnxoval(faxina)">Limpeza Finalizada</span>
            <button class="btn-info" (click)="abrirModal(faxina)">Mais</button>

          </div>
        </div>
      </div>
    </section>
    
    <!-- Faxinas por Período -->
    <section *ngIf="activeTab === 'futuras'">
      <!-- Controles de período -->
      <div class="periodo-controles">
        <div class="periodo-input-group">
          <label for="dataInicio">De</label>
          <input type="date" id="dataInicio" [(ngModel)]="dataInicio" />
        </div>
        
        <div class="periodo-input-group">
          <label for="dataFim">Até</label>
          <input type="date" id="dataFim" [(ngModel)]="dataFim" />
        </div>
        
        <button (click)="pesquisarPeriodo()" class="btn-pesquisar">
          <i class="fas fa-search"></i> Pesquisar
        </button>
      </div>

      <div class="enxoval-summary" *ngIf="!carregandoFuturas && faxinasFuturas.length">
        <div class="summary-title">Enxoval necessário para o período</div>
        <div class="summary-grid">
          <div class="summary-chip"><span>SL Casal</span><strong>{{ enxovalTotaisFuturas.enxovalSobreLencolCasal }}</strong></div>
          <div class="summary-chip"><span>SL Solteiro</span><strong>{{ enxovalTotaisFuturas.enxovalSobreLencolSolteiro }}</strong></div>
          <div class="summary-chip"><span>Fronha</span><strong>{{ enxovalTotaisFuturas.enxovalFronha }}</strong></div>
          <div class="summary-chip"><span>Toalhas</span><strong>{{ enxovalTotaisFuturas.enxovalToalhas }}</strong></div>
          <div class="summary-chip"><span>Pisos</span><strong>{{ enxovalTotaisFuturas.enxovalPisos }}</strong></div>
          <div class="summary-chip"><span>Rostos</span><strong>{{ enxovalTotaisFuturas.enxovalRostos }}</strong></div>
          <div class="summary-chip total-chip"><span>Total de peças</span><strong>{{ totalDePecasEnxoval(enxovalTotaisFuturas) }}</strong></div>
        </div>
      </div>

      <div class="faxina-cards mobile-only">
        <div *ngIf="carregandoFuturas" class="carregando">
          Carregando...
        </div>
        <div *ngIf="!carregandoFuturas && faxinasFuturas.length === 0" class="no-data">
          Nenhuma faxina encontrada para o período selecionado.
        </div>
        <div *ngFor="let faxina of faxinasFuturas"  
             class="faxina-card"   
             [class.cancelada]="faxina.description === 'CANCELADA'">
          <div class="card-header">
            <h3>Apt {{ faxina.apartamento_nome }}</h3>
            <ng-container *ngIf="faxina.description === 'CANCELADA'">
                <span class="status-badge" [class.done]="faxina.limpeza_realizada">
                  {{ '❌ CANCELADA' }}
                </span>
            </ng-container>
            <ng-container *ngIf="faxina.description !== 'CANCELADA'">
                <span class="status-badge" [class.done]="faxina.limpeza_realizada">
                  {{ faxina.limpeza_realizada ? '✔ Finalizado' : '⌛️ Pendente' }}
                </span>
            </ng-container>
          </div>
          <div class="card-body">
            <div class="card-row">
              <strong>Data:</strong>
              <strong>{{ faxina.end_data }}</strong>
            </div>
            <div class="card-row">
              <strong>Dia:</strong>
              <strong>{{ getDiaDaSemana(formatarData(faxina.end_data)) }}</strong>
            </div>
            <div class="card-row">
              <strong>Check-Out:</strong>
              <span>{{ faxina.check_out }} – {{ formatarCheckInMesmoDia(faxina) }}</span>
            </div>
            <div class="card-row">
              <strong>Senha:</strong>
              <strong>{{ faxina.apartamento_senha }}</strong>
            </div>
          </div>
          <!-- Mantive o checkbox caso queira toggle manual -->
          <div class="card-footer">
            <label class="custom-checkbox">
              <input type="checkbox"
                    [checked]="faxina.limpeza_realizada"
                    (change)="updateStatus(faxina, 'limpeza_realizada', $event, 'faxinasFuturas')">
              <span class="checkmark"></span>
            </label>
            <span (click)="abrirModalEnxoval(faxina)">Limpeza Finalizada</span>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
<!-- Modal para detalhes do apartamento -->
<div class="modal-overlay" *ngIf="modalAberto" (click)="fecharModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="fecharModal()">&times;</button>
    
    <h2>Apt {{ apartamentoSelecionado?.apartamento_nome }}</h2>
    
    <div class="modal-body">
      <div class="modal-row">
        <strong>Status:</strong>
        <span [class]="apartamentoSelecionado?.limpeza_realizada ? 'status-finalizado' : 'status-pendente'">
          {{ apartamentoSelecionado?.limpeza_realizada ? '✔ Finalizado' : '⌛️ Pendente' }}
        </span>
      </div>
      <div class="modal-row">
        <strong>Data:</strong>
        <span>{{ apartamentoSelecionado?.end_data }}</span>
      </div>
      <div class="modal-row">
        <strong>Dia da semana:</strong>
        <span>{{ getDiaDaSemana(formatarData(apartamentoSelecionado?.end_data)) }}</span>
      </div>
      <div class="modal-row">
        <strong>Senha:</strong>
        <span>{{ apartamentoSelecionado?.apartamento_senha }}</span>
      </div>  
      <div class="modal-row">
        <strong>Check-Out:</strong>
        <span>{{ apartamentoSelecionado?.check_out }} – {{ formatarCheckInMesmoDia(apartamentoSelecionado) }}</span>
      </div>
      
      <div class="modal-row" >
        <strong>Endereço:</strong>
      </div>
      <div class="modal-row" >
        <span>{{ apartamentoSelecionado?.endereco }}</span>
      </div>
      <div class="modal-row">
        <button class="btn-info" *ngIf="apartamentoSelecionado?.endereco" (click)="abrirGoogleMaps(apartamentoSelecionado?.endereco)">
          Ver rota no Google Maps
        </button>
      </div>

    </div>
    
    <div class="modal-footer">
      <button class="btn-fechar" (click)="fecharModal()">Fechar</button>
    </div>
  </div>
</div>

<!-- Modal de Enxoval -->
<div class="modal-overlay" *ngIf="modalEnxovalAberto" (click)="fecharModalEnxoval()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="fecharModalEnxoval()">&times;</button>
    <h2>
      Enxoval – Apt {{ apartamentoSelecionado?.apartamento_nome || enxovalSelecionado?.nome || '—' }}
    </h2>

    <div class="modal-body">
      <div class="modal-row"><strong>Itens para retirar:</strong></div>
      <div class="modal-row" *ngIf="enxovalSelecionado?.enxoval_sobre_lencol_casal > 0">
        <span>Sobrelençol (Casal): {{ enxovalSelecionado?.enxoval_sobre_lencol_casal }}</span>
      </div>
      <div class="modal-row" *ngIf="enxovalSelecionado?.enxoval_sobre_lencol_solteiro > 0">
        <span>Sobrelençol (Solteiro): {{ enxovalSelecionado?.enxoval_sobre_lencol_solteiro }}</span>
      </div>
      <div class="modal-row" *ngIf="enxovalSelecionado?.enxoval_fronha > 0">
        <span>Fronhas: {{ enxovalSelecionado?.enxoval_fronha }}</span>
      </div>
      <div class="modal-row" *ngIf="enxovalSelecionado?.enxoval_toalhas > 0">
        <span>Toalhas de banho: {{ enxovalSelecionado?.enxoval_toalhas }}</span>
      </div>
      <div class="modal-row" *ngIf="enxovalSelecionado?.enxoval_pisos > 0">
        <span>Toalhas de piso: {{ enxovalSelecionado?.enxoval_pisos }}</span>
      </div>
      <div class="modal-row" *ngIf="enxovalSelecionado?.enxoval_rostos > 0">
        <span>Toalhas de rosto: {{ enxovalSelecionado?.enxoval_rostos }}</span>
      </div>
      <div class="modal-row" *ngIf="!enxovalSelecionado || (
          !(enxovalSelecionado?.enxoval_sobre_lencol_casal > 0) &&
          !(enxovalSelecionado?.enxoval_sobre_lencol_solteiro > 0) &&
          !(enxovalSelecionado?.enxoval_fronha > 0) &&
          !(enxovalSelecionado?.enxoval_toalhas > 0) &&
          !(enxovalSelecionado?.enxoval_pisos > 0) &&
          !(enxovalSelecionado?.enxoval_rostos > 0)
        )">
        <em>Nenhum item de enxoval cadastrado para retirada.</em>
      </div>

      <div class="modal-row" style="margin-top: 12px; border-top: 1px solid #e5e5e5; padding-top: 8px;">
        <strong>Total de peças:</strong>&nbsp;
        <span>{{ getTotalPecasEnxoval(enxovalSelecionado) }}</span>
      </div>
    </div>

    <div class="modal-footer">
  <button class="btn-primary" (click)="fecharModalEnxoval()">Confirmar</button>

      <button class="btn-fechar" (click)="fecharModalEnxoval()">Fechar</button>
    </div>
  </div>
</div>