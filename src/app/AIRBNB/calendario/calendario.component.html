<div class="calendar-container">
  <!-- Header Section -->
  <ng-container class="header-container">
    <div class="calendar-header">
      <!-- Navigation -->
      <ng-container class="navigation-container">
        <div class="navigation">
          <button class="nav-button" (click)="changeMonth(-1)">‹</button>
          <h2 class="current-month">{{ currentMonth }} {{ currentYear }}</h2>
          <button class="nav-button" (click)="changeMonth(1)">›</button>
        </div>
      </ng-container>
      
      <!-- View Options -->
      <ng-container class="view-options-container">
        <div class="view-options">
          <button class="view-option" [class.active]="viewMode === 'global'" (click)="setViewMode('global')">Visão Global</button>
          <button class="view-option" [class.active]="viewMode === 'detail'" (click)="setViewMode('detail')" *ngIf="selectedApartmentId">Detalhes</button>
        </div>
      </ng-container>
    </div>
  </ng-container>

  <!-- Global View Section -->
  <ng-container class="global-view-container" *ngIf="viewMode === 'global'">
    <div class="global-view">
      <div class="table-scroll-container" #scrollContainer>
        <div class="table-container">
          
          <!-- Table Header -->
          <ng-container class="table-header-container">
            <div class="table-header">
              <div class="apartments-header">
                <ng-container class="search-container-wrapper">
                  <div class="search-container">
                    <input type="text" 
                          [(ngModel)]="searchTerm" 
                          (input)="filterApartments()"
                          placeholder="Buscar apt..."
                          class="search-input">
                    <span class="search-icon"><i class="fas fa-search"></i></span>
                  </div>
                </ng-container>
              </div>
              
              <div class="days-header-scroll">
                <ng-container class="days-header-container">
                  <div class="days-header">
                    <div class="day-header" *ngFor="let day of daysInMonthRange">
                      <div class="week-day">{{ getWeekDay(day) }}</div>
                      <div class="month-day" [class.today]="isToday(day)">{{ day.getDate() }}</div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>

          <!-- Table Body -->
          <ng-container class="table-body-container">
            <div class="table-body">
              <div *ngFor="let apt of filteredApartments" class="apartment-row">
                <ng-container class="apartment-cell-container">
                  <div class="apartment-cell">
                    <div class="apartment-info" [class.selected]="apt.id === selectedApartmentId" (click)="selectApartment(apt.id)">
                      <div class="apartment-color" [style.background]="apt.color"></div>
                      <div class="apartment-name">{{ apt.name }}</div>
                    </div>
                  </div>
                </ng-container>
                
                <ng-container>
                  <div class="day-cell" *ngFor="let day of daysInMonthRange" >
                     <ng-container *ngIf="getDayType(apt, day)=='inAir'">
                          <div class="day-cell-inAir"></div>
                     </ng-container>
                     <ng-container *ngIf="getDayType(apt, day)=='inBook'">
                          <div class="day-cell-inBook"></div>
                     </ng-container>
                     <ng-container *ngIf="getDayType(apt, day)=='outAir'">
                          <div class="day-cell-outAir"></div>
                     </ng-container>
                     <ng-container *ngIf="getDayType(apt, day)=='outBook'">
                          <div class="day-cell-outBook"></div>
                     </ng-container>
                     <ng-container *ngIf="getDayType(apt, day)=='air'">
                          <div class="day-cell-air"></div>
                     </ng-container>
                    <ng-container *ngIf="getDayType(apt, day)=='book'">
                          <div class="day-cell-book"></div>
                     </ng-container>
                    <ng-container *ngIf="getDayType(apt, day)=='inOutAir'">
                        <div class="in-out-container">
                          <div class="half half-out" style="background: #EF4444;"></div> 
                          <div class="half half-in"  style="background: #EF4444;"></div> 
                        </div>
                    </ng-container>
                    <ng-container *ngIf="getDayType(apt, day)=='inOutBook'">
                        <div class="in-out-container">
                          <div class="half half-out" style="background: #3B82F6;"></div> 
                          <div class="half half-in"  style="background: #3B82F6;"></div> 
                        </div>
                     </ng-container>
                      <ng-container *ngIf="getDayType(apt, day)=='inAirOutBook'">
                               <div class="in-out-container">
                        <div class="half half-out"  style="background: #EF4444;"></div> 
                        <div class="half half-in"   style="background: #3B82F6;"></div> 
                      </div>
                     </ng-container>
                      <ng-container *ngIf="getDayType(apt, day)=='inBookOutAir'">
                        <div class="in-out-container">
                          <div class="half half-out" style="background: #3B82F6;"></div>
                          <div class="half half-in"  style="background: #EF4444;"></div>
                        </div>
                     </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </ng-container>

<!-- DETAIL VIEW CUSTOM PARA ESTA TELA -->
<ng-container class="detail-view-container" *ngIf="viewMode === 'detail' && selectedApartment">
  <div class="detail-root">

    <!-- CABEÇALHO FIXO PERSONALIZADO -->
    <div class="detail-header">
      <div class="detail-apartment-info">
        <div class="detail-apartment-dot" [style.background]="selectedApartment.color"></div>
        <div class="detail-apartment-title">{{ selectedApartment.name }}</div>
        <span class="detail-badge"
              [ngClass]="{
                'detail-available': selectedApartment.status === 'Disponível',
                'detail-occupied': selectedApartment.status === 'Ocupado',
                'detail-maintenance': selectedApartment.status === 'Manutenção'
              }">
          {{ selectedApartment.status }}
        </span>
      </div>
    </div>

    <!-- GRADE DO CALENDÁRIO DETALHADO -->
    <div class="detail-calendar-container">
      <div class="detail-weekdays-header">
        <div class="detail-weekday" *ngFor="let w of weekDays">{{ w }}</div>
      </div>
      <div class="detail-days-body" #detailScroll>
        <div class="detail-day-cell"
             *ngFor="let day of calendarDays"
             [class.detail-outside]="!day.isCurrentMonth"
             [class.detail-today]="isToday(day.date)">
          <div class="detail-day-number">{{ day.date.getDate() }}</div>
          <ng-container *ngFor="let ev of day.events">
            <div
              class="detail-event"
              [ngClass]="ev.source === 'airbnb' ? 'event-airbnb' : 'event-booking'">
              {{ ev.cod_reserva }}
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- LEGENDA SEPARADA -->
    <div class="detail-legend">
      <div class="detail-legend-item">
        <div class="detail-legend-dot booking"></div><span>Booking</span>
      </div>
      <div class="detail-legend-item">
        <div class="detail-legend-dot airbnb"></div><span>Airbnb</span>
      </div>
    </div>

  </div>
</ng-container>


</div>