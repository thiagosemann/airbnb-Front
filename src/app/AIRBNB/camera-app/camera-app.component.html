<div class="full-screen-container">
  <div class="container">
    <img src="../../../assets/images/logo-com-frase-V2.png" alt="Logo Lamp" class="logo-img">
    
    <!-- Etapa 1: Formulário de informações -->
    <div *ngIf="step === 1" class="compact-form">
      <div class="info-box">
        <i class="fas fa-info-circle"></i>
       As informações fornecidas serão usadas única e exclusivamente para o seu cadastro junto ao prédio em que você irá se hospedar, garantindo segurança e agilidade no seu atendimento.
      </div>
      
      <form (ngSubmit)="goForward()">
        <div class="form-group">
          <label for="id">Código da Reserva:</label>
          <input type="text" class="form-control" id="id" [(ngModel)]="id" name="id" disabled required>
        </div>
        <div class="form-group">
          <label for="cpf">Sou estrangeiro?</label>
          <input type="checkbox" id ="souEstrangeiro" [(ngModel)]="souEstrangeiro" name="souEstrangeiro">
          <ng-container *ngIf="souEstrangeiro">
            <label for="passaport">Passaporte:</label>
            <input type="text" class="form-control" id="cpf" placeholder="Digite o Passaporte" [(ngModel)]="formData.cpf" name="cpf" required >
          </ng-container>
          <ng-container *ngIf="!souEstrangeiro">
            <label for="cpf">CPF:</label>
            <input type="text" class="form-control" id="cpf" placeholder="000.000.000-00" [(ngModel)]="formData.cpf" name="cpf" required mask="000.000.000-00">
          </ng-container>

        </div>
        <div class="form-group">
          <label for="name">Nome:</label>
          <input type="text" class="form-control" id="name" placeholder="Seu nome completo" [(ngModel)]="formData.nome" name="nome" required>
        </div>
        <div class="form-group">
          <label for="phone">Telefone:</label>
          <input type="tel" class="form-control" id="phone" placeholder="(00) 00000-0000" [(ngModel)]="formData.telefone" name="telefone" mask="(00) 00000-0000" required>
        </div>
        <div class="form-group">
          <label for="expectedTime">Horário previsto de entrada no apartamento:</label>
          <div class="carousel-container">
            <div
              class="hour-card"
              *ngFor="let hour of hourOptions"
              [class.selected]="formData.horarioPrevistoChegada === hour"
              (click)="selectHour(hour)"
            >
              {{ hour }}
              <small *ngIf="isNextDay(hour)" class="next-day-label">
                (Dia Seguinte)
              </small>
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-success">Próximo <i class="fas fa-arrow-right"></i></button>
      </form>
    </div>

    <!-- Etapa 2: Uploads (Selfie e Documento) -->
    <div *ngIf="step === 2">
      <h3>Envio de arquivos</h3>
      <ng-container *ngIf="pedir_selfie; else onlyDocumentoCallout">
        <div class="info-callout">
          <i class="fas fa-info-circle"></i>
          <div>
            <p>Para finalizar, envie 2 arquivos obrigatórios:</p>
            <ul class="callout-list">
              <li><strong>1) Selfie do hóspede</strong> — Foto semelhante a 3x4, nítida, do peito para cima, sem adornos.</li>
              <li><strong>2) Documento com foto</strong> — RG, CNH ou Passaporte (frente).</li>
            </ul>
            <p class="formats-note">Formatos aceitos: JPG, PNG ou PDF. Tamanho máximo: 5MB por arquivo.</p>
          </div>
        </div>
      </ng-container>
      <ng-template #onlyDocumentoCallout>
        <div class="info-callout">
          <i class="fas fa-info-circle"></i>
          <div>
            <p>Para finalizar, envie <strong>apenas o documento com foto</strong> do hóspede.</p>
            <ul class="callout-list">
              <li><strong>Documento com foto</strong> — RG, CNH ou Passaporte (frente).</li>
            </ul>
            <p class="formats-note">Formatos aceitos: JPG, PNG ou PDF. Tamanho máximo: 5MB.</p>
          </div>
        </div>
      </ng-template>

      <!-- Selfie (opcional conforme configuração do apartamento) -->
      <div class="upload-section" *ngIf="pedir_selfie">
        <div class="upload-header">
          <span class="num-badge">1</span>
          <div class="upload-title">
            <strong><i class="fas fa-user-circle"></i> Selfie do hóspede</strong>
            <span class="helper-text">Foto nítida do rosto, bem iluminada.</span>
          </div>
          <span class="status-badge" [ngClass]="photoDataUrl ? 'ok' : 'pending'">
            {{ photoDataUrl ? 'OK' : 'Pendente' }}
          </span>
        </div>
        <div class="form-group">
          <label for="selfieUpload">Selfie (imagem ou PDF)</label>
          <input type="file" accept="image/*,application/pdf" class="form-control" id="selfieUpload" (change)="onSelfieSelected($event)">
        </div>
        <div class="preview-card" *ngIf="photoDataUrl">
          <div class="preview-thumb">
            <img *ngIf="photoDataUrl.startsWith('data:image')" [src]="photoDataUrl" class="preview-img" alt="Selfie">
            <img *ngIf="photoDataUrl.startsWith('data:application/pdf')" src="../../../assets/images/PDF.png" class="preview-pdf" alt="PDF selecionado">
          </div>
          <div class="preview-body">
            <p class="preview-title">Selfie pronta</p>
            <p class="preview-sub">Arquivo selecionado com sucesso.</p>
          </div>
        </div>
      </div>

      <!-- Documento -->
      <div class="upload-section">
        <div class="upload-header">
          <span class="num-badge">{{ pedir_selfie ? '2' : '1' }}</span>
          <div class="upload-title">
            <strong><i class="fas fa-id-card"></i> Documento do hóspede</strong>
            <span class="helper-text">RG, CNH ou Passaporte (apenas a frente, legível).</span>
          </div>
          <span class="status-badge" [ngClass]="documentFile ? 'ok' : 'pending'">
            {{ documentFile ? 'OK' : 'Pendente' }}
          </span>
        </div>
        <div class="form-group">
          <label for="fileUpload">Documento (imagem ou PDF)</label>
          <input type="file" class="form-control" id="fileUpload" accept="image/*,application/pdf" (change)="onFileSelected($event)">
        </div>
        <div class="preview-card" *ngIf="documentFile">
          <div class="preview-thumb">
            <img *ngIf="documentFile.startsWith('data:image')" [src]="documentFile" class="preview-img" alt="Documento">
            <img *ngIf="documentFile.startsWith('data:application/pdf')" src="../../../assets/images/PDF.png" class="preview-pdf" alt="PDF selecionado">
          </div>
          <div class="preview-body">
            <p class="preview-title">Documento pronto</p>
            <p class="preview-sub">Arquivo selecionado com sucesso.</p>
          </div>
        </div>
      </div>

      <!-- Garagem: placa do carro (apenas se tem_garagem = true) -->
      <div class="upload-section" *ngIf="tem_garagem === true">
        <div class="upload-header">
          <span class="num-badge">{{ pedir_selfie ? '3' : '2' }}</span>
          <div class="upload-title">
            <strong><i class="fas fa-car"></i> Placa do carro</strong>
            <span class="helper-text">Informe a placa do veículo para cadastro na garagem.</span>
          </div>
        </div>
        <div class="form-group">
          <label for="placaCarro">Placa do carro</label>
          <input type="text" id="placaCarro" class="form-control" [(ngModel)]="placaCarro" name="placaCarro" placeholder="ABC-1234 ou ABC1D23" maxlength="8">
        </div>
      </div>

      <div class="cta-footer">
        <button (click)="sendData()" class="btn btn-success"
                [disabled]="(pedir_selfie ? !photoDataUrl : false) || !documentFile || (tem_garagem === true && !placaCarro)">
          {{ pedir_selfie ? (tem_garagem ? 'Enviar selfie, documento e placa' : 'Enviar selfie e documento') : (tem_garagem ? 'Enviar documento e placa' : 'Enviar documento') }}
        </button>
        <button (click)="goBack()" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Voltar</button>
      </div>
    </div>

    <!-- Etapa 4: Carregando -->
    <div *ngIf="step === 4" class="text-center">
      <div class="loader-container-processando ">
        <div class="loader"></div>
      </div>
      <h2>Processando...</h2>
    </div>

    <!-- Etapa 5: Concluído -->
    <div *ngIf="step === 5" class="text-center">
      <i class="fas fa-check-circle success-icon"></i>
      <h2>Cadastro concluído com sucesso.</h2>
      <button (click)="resetFlow()" class="btn btn-success mt-3"><i class="fas fa-user-plus"></i> Cadastrar outro Hóspede</button>
      <button (click)="concluirCadastro()" class="btn btn-danger mt-3"><i class="fas fa-times"></i> Encerrar</button>
    </div>

    <!-- Etapa 6: Concluído -->
    <div *ngIf="step === 6" class="text-center">
      <h2>Obrigado por se hospedar com a Forest!!</h2>
    </div>
  </div>
</div>
<!-- Botão flutuante do WhatsApp -->
<a href="https://wa.me/5541999283936" class="whatsapp-float" target="_blank" aria-label="Fale conosco no WhatsApp">
  <i class="fab fa-whatsapp"></i>
</a>


